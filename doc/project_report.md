# 作业报告

## 题目

魔兽世界之三：开战

## 姓名 学号

刘振伟 202200130086

## 最终完成的任务难度

最终完成的任务难度为难度三，完成了额外的游戏界面。

### 界面使用说明

带后缀 `_CLI` 的为命令行界面，带后缀 `_boxed` 的为图形界面。

命令行界面的使用方法与实验中默认要求的是一样的.

图形界面的使用方法如下：

在打开图形界面后，右侧自上至下会有文本输入框，文本输出框，以及 `start` 选项。

在文本输入框边上有 `Default Data` 选项，点击后会在文本输入框中输入默认的数据，可以直接点击 `start` 按钮开始游戏。

通过文本输入框可以输入指令，与命令行界面的输入格式相同。输入后点击 `start` 按钮即可开始游戏。

游戏开始后，文本输出框会显示游戏的输出信息。图形界面左侧会出现，额，很简约的动画...

## 程序文件的组织架构

游戏的运行逻辑在命令行界面和图形界面中是一样的，所以此处只介绍命令行界面的组织架构,图形界面的组织架构与之类似，只是增加了一些图形界面的组件。

### CLI 界面的组织架构

程序包含以下几个类：

- `main_CLI.cpp`：主函数，用于启动游戏。

- `EventHandler` 类：事件处理类，用于处理执行游戏中的事件，包括生成武士、武士前进、武士战斗、武士逃跑等。

- `AbstractCity` 类：抽象的城市类，包含城市的基本信息，包括城市的编号，城市是否为红蓝司令部，以及有城市的战斗事件处理方法、对于武士的 `add` 和 `remove` 方法等。

- `City` 类：城市类，继承自 `AbstractCity` 类，包含城市的具体信息，包括城市的编号等。

- `Headquarter` 类：司令部类，继承自 `AbstractCity` 类，包含司令部的基本信息，包括司令部的生命元，司令部的颜色，存储着所在方所有武士的指针等。

- `Warrior` 类：武士类，包含武士的基本信息，包括武士的编号，武士的生命值，武士的攻击力等，战斗的方法。从 `Warrior` 类中派生出五个武士类，分别是 `Dragon`、`Ninja`、`Iceman`、`Lion`、`Wolf`。实现其各自特性。

- `Weapon` 类：武器类，包含武器的基本信息。派生出三个武器类，分别是 `Sword`、`Bomb`、`Arrow`。实现其各自特性。主要的作用是提供一个接口返回武器造成的伤害。

- `WarrirorFactory` 与 `WeaponFactory` 类：武士工厂类与武器工厂类，用于创建武士与武器，其静态方法会返回一个指向新创建的武士或武器的智能指针。

- `GameIO` 类：游戏输入输出类，这里只用来输出。

- `GameClock` 类：游戏时钟类，记录游戏时间,判断游戏是否到时间等。

- `Enums.h` 这个文件包含了一些数据和枚举类。

### 图形界面中增加的类

- `main.cpp`：主函数，用于启动游戏。

- `Game` 类：游戏类，包含游戏的主要逻辑，与 `main_CLI.cpp` 中的 `part3_test()` 函数类似，都是负责游戏的一些初始化。

- `GameIO` 类：游戏输入输出类，这里通过函数回调把原来的输出传递给图形界面。

- `mainwindow` 类：游戏主窗口类，包含游戏的主窗口。

- `GameFrame` 类：游戏的动画界面类，用来显示游戏动画

## 程序完成的主要逻辑

### CLI 界面的主要逻辑

程序在启动后，会先进入 `main_CLI.cpp` 中的 `main` 函数，`main` 函数会调用同文件内的 `part3_test()` 函数，这个函数通过  `std::cin` 来获取游戏输入，同时会创建 一个 `EventHandler` 对象，对其进行必要的初始化，`EventHandler` 对象负责游戏的主要逻辑。

每局游戏前都会进行必要的初始化，包括初始化城市，司令部，武士数值以及时钟等。

在一个循环中，每次循环时钟都会更新，并调用 `EventHandler` 的 `onClockUpdate` 方法,该方法通过时钟的时间判断应该执行什么事件，包括武士的前进，武士的战斗，武士的逃跑，司令部的生产武士以及游戏结束等。这些执行的事件函数会依次调用其他类中的对应函数，完成游戏的主要逻辑。

如生成武士调用 `Headquater` 类中的方法，武士的战斗调用 `City` 类中的方法，而 `City` 类通过判断自身是否有两个武士来判断，如果有则会调用 `Warrior` 类中的方法，完成武士的战斗。

如 `lion` 逃跑事件，会遍历所有的城市，调用 `City` 类中的 `lionEscape` 方法，该方法会判断城市中是否有 `lion`，如果有则会判断 `lion` 是否逃跑，如果逃跑则会会将城市中的 `lion` 移除。同时调用 `GameIO` 类中的静态方法输出逃跑信息在控制台中。

### 图形界面的主要逻辑

图形界面在 打开 一个 QApplication 后，会创建一个 `mainwindow` 对象，`mainwindow` 对象中的文本输入输出框负责获取信息,`mainwindow` 对象中的 `GameFrame` 对象负责显示游戏界面。

当 `start` 按钮被点击后，`mainwindow`会检查输入是否为空，如果为空，则会提示输入为空，否则会会调用 `runGame` 方法，创建一个 `Game` 对象，`Game` 对象负责游戏的主要逻辑，与 CLI 界面的是一样的。这时候 CLI 界面本来的控制台输出会通过 `GameIO`中 函数回调的方式传递给 `mainwindow` 对象，`mainwindow` 对象会将输出显示在文本输出框中，这就完成了 CLI 界面的文本输出到图形界面的转换。

同时，`Game` 对象会返回必要的游戏信息，`mainwindow` 对象会将这些信息传递给 `GameFrame` 对象，`GameFrame` 对象会根据这些信息绘制并更新动画界面。

关于图形界面的实现逻辑，主要是调用 Qt 的一些轮子，这里不再赘述。
