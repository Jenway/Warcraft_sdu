name: Build

on:
  push:
    branches: [ "master" ]
    # tags:
    #   - "v*"  # Push events to matching v*, i.e. v1.0, v20.15.10

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Release
  # Customize the qt version ,qt_arch, msvc_arch here
  QT_VER: 6.5.2
  QT_HOST: windows
  QT_TARGET: desktop
  QT_ARCH: win64_msvc2019_64
  # Customize the target name here
  targetName: "Warcraft"

jobs:
  build:

    runs-on: windows-latest

    steps:

    - name: Checkout
      uses: actions/checkout@v4

    - name: Install Qt
      uses: jurplel/install-qt-action@v3
      with:
        version: ${{ env.QT_VER }}
        host: ${{ env.QT_HOST }}
        target: ${{ env.QT_TARGET }}
        arch: ${{ env.QT_ARCH }}
        install-deps: 'true'

    - name: Configure CMake
      # Configure CMake in a 'build' subdirectory.
      # `CMAKE_BUILD_TYPE` is only required if you are using a single-configuration generator such as make.
      # See https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html?highlight=cmake_build_type
      run: cmake -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }} -B '${{ github.workspace }}/build'
    
    - name: Build
      # Build your program with the given configuration
      run: cmake --build '${{github.workspace}}/build' -v --config ${{ env.BUILD_TYPE }}
    
    - name: Release
      uses: softprops/action-gh-release@v1
    #   if: startsWith(github.ref, 'refs/tags/')
      with:
        files: |
          ${{github.workspace}}/build/${{env.BUILD_TYPE}}/${{env.targetName}}.exe
        # tag_name: ${{github.ref}}
        # body: |
        #   ${{github.ref}}
        # draft: false
        # prerelease: false
        token: ${{secrets.RELEASE_TOKEN}}